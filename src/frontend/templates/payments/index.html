<!DOCTYPE html>
<html>
<head>
    <title>{{ item.name }}</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>{{ item.name }}</h1>
    <p>{{ item.description }}</p>
    <p>Price: ${{ item.price }}</p>

    <button id="buy-button">Buy</button>

    <script>
        const stripe = Stripe("{{ stripe_public_key }}");
        console.log("{{ stripe_public_key }}")

        document.getElementById("buy-button").addEventListener("click", () => {
            fetch("/api/v1/buy/{{ item.pk }}/")
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                console.log("11111111111111111")
                console.log(data.session_id)
                    if (data.session_id) {
                        stripe.redirectToCheckout({ sessionId: data.session_id });
                    } else {
                        alert("Ошибка при создании платежа.");
                    }
                })
                .catch(error => {
                    console.error("Fetch error:", error);
                    alert("Ошибка сети, попробуйте позже.");
                });
        });
    </script>
</body>
</html>
